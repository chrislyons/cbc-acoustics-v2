# Project Vision & Original Implementation Analysis

**Sprint Goal:** Establish project context and technical foundation for autonomous rebuild  
**Prerequisites:** None (foundational document)  
**Estimated Effort:** 2-4 hours (reading, analysis, planning)  
**Status:** âœ… Complete (generated by setup script)

---

## Context

The CBC Acoustics Dashboard v1 successfully visualized acoustic measurement data for Studio 8, but suffers from:
- **Performance issues** (Streamlit full-page reloads)
- **Limited interactivity** (sluggish 3D rendering)
- **No mobile support** (desktop-only)
- **Aesthetic limitations** (default Python chart styling)

This v2 rebuild will preserve all backend data and calculation models while modernizing the frontend with current web development best practices.

---

## Objectives

- [x] Document original v1 architecture and components
- [x] Identify preserved backend elements (data, formulas)
- [x] Define improvement areas for frontend
- [x] Establish autonomous Claude Code workflow
- [x] Create sprint breakdown (ACU002-ACU005)

---

## Original Implementation Summary

### Stack (v1)
- **Framework:** Streamlit (Python web app)
- **Visualization:** Plotly + custom 3D
- **Data:** Pandas CSVs
- **Deployment:** Streamlit Cloud

### Core Components
1. **Main Dashboard** (`web_acoustic_dashboard.py`)
   - Multi-tab interface (Executive, 3D, Frequency, Simulator, Complete)
   - Session state management
   - CSV loading with synthetic fallbacks

2. **3D Visualizer** (`enhanced_3d_visualizer.py`)
   - Room model: 12.3' x 10.6' x 8.2'
   - 7 measurement positions
   - Slider-controlled panel placement
   - STI degradation color coding

3. **Frequency Explorer** (`frequency_response_explorer.py`)
   - Multi-position response curves (20Hz-20kHz)
   - Modal analysis (room resonances)
   - Position vs frequency heatmaps

4. **Treatment Simulator** (`treatment_simulator.py`)
   - RT60 predictions (Sabine equation)
   - STI improvement estimates
   - Cost optimization ($1,200 budget)
   - Panel parameters (count, thickness, drape)

### Data (Immutable Truth)
- **Source:** July 15, 2025 Smaart measurements
- **Positions:** HostA (reference), HostB/C, Pos1-4
- **Range:** 20Hz - 20kHz (1/3 octave bands)
- **Format:** `timestamp,frequency,spl,phase,position`

---

## What to Preserve

### âœ… Backend (Must Preserve Exactly)
1. **Measurement Data**
   - All CSV files (byte-for-byte)
   - HostA = reference (0 degradation)
   - Frequency bands and SPL values

2. **Calculation Formulas**
   - RT60: Sabine/Eyring equations
   - STI: IEC 60268-16 degradation model
   - Room modes: Modal frequency calculation
   - Panel absorption: Frequency-dependent coefficients

3. **Physical Constraints**
   - Room dimensions: 12.3' x 10.6' x 8.2'
   - Measurement positions (x,y,z coordinates)
   - Panel specs: 2" or 4" thickness, absorption curves
   - Budget: $1,200 maximum

4. **Standards Compliance**
   - ITU-R BS.1116 (critical listening rooms)
   - EBU R128 (broadcast audio)
   - Target RT60: 0.3s (measured: 0.92s)

### ðŸŽ¨ Improve (Frontend Rebuild)
1. **Performance**
   - Sub-100ms interaction response
   - No full-page reloads
   - Smooth 3D rendering (60fps)
   - Optimized data loading

2. **Technology Stack**
   - Modern web framework (React/Next.js/Vue)
   - WebGL 3D (Three.js or similar)
   - Responsive design (mobile â†’ desktop)
   - Component-based architecture

3. **User Experience**
   - Professional aesthetics (not default charts)
   - Touch-friendly interactions
   - Comparison mode (before/after side-by-side)
   - Shareable configurations
   - Better export options

4. **Accessibility**
   - WCAG 2.1 AA compliance
   - Keyboard navigation
   - Screen reader support
   - High contrast mode

---

## v2 Architecture Direction

### Recommended Stack
**Framework:** Next.js (React) or Vue 3 + Vite  
**Rationale:** Modern, performant, great ecosystem, good deployment options

**Visualization:**
- **3D:** Three.js (WebGL) for room model
- **Charts:** D3.js or Recharts (avoid Plotly dependency)
- **Canvas API:** For heatmaps and custom plots

**State Management:** React Context or Pinia (Vue)

**Styling:** Tailwind CSS + shadcn/ui components

**Data:** Static JSON (converted from CSVs) + calculation modules

**Deployment:** Cloudflare Pages or Vercel (Chris has CF Workers experience)

### File Structure (Proposed)
```
cbc-acoustics-v2/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/              # Next.js app router (or Vue pages)
â”‚   â”œâ”€â”€ components/       # Reusable UI components
â”‚   â”‚   â”œâ”€â”€ Layout/
â”‚   â”‚   â”œâ”€â”€ Controls/
â”‚   â”‚   â””â”€â”€ Visualizations/
â”‚   â”œâ”€â”€ lib/              # Core logic
â”‚   â”‚   â”œâ”€â”€ acoustics/    # RT60, STI calculations
â”‚   â”‚   â”œâ”€â”€ data/         # Data loading/parsing
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â””â”€â”€ styles/           # Global styles
â”œâ”€â”€ public/
â”‚   â””â”€â”€ data/             # JSON data files
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/             # Calculation tests
â”‚   â””â”€â”€ integration/      # Component tests
â””â”€â”€ docs/acu/             # Sprint docs
```

---

## Sprint Breakdown

### ACU002: Sprint 1 - Project Setup & Data Migration
**Goal:** Scaffold v2 repo, migrate data, validate calculations

**Tasks:**
- [x] Run setup script (this creates the repo)
- [ ] Clone original repo for reference
- [ ] Convert CSV data to JSON format
- [ ] Port RT60/STI calculation functions
- [ ] Write unit tests for calculations
- [ ] Validate outputs match v1

**Deliverables:**
- Working calculation modules (tested)
- JSON data files (validated)
- Test suite (>90% coverage for calculations)

**Estimated:** 1-2 days

---

### ACU003: Sprint 2 - Modern Frontend Architecture
**Goal:** Choose framework, design component hierarchy, scaffold app

**Tasks:**
- [ ] Evaluate frameworks (Next.js vs Vue vs other)
- [ ] Set up build tooling (Vite/Next config)
- [ ] Design component architecture
- [ ] Create design system (colors, spacing, typography)
- [ ] Scaffold basic layout (header, sidebar, main area)
- [ ] Implement routing/navigation

**Deliverables:**
- Running dev server
- Basic app shell (no visualizations yet)
- Component library storybook/demo
- Design tokens (Tailwind config)

**Estimated:** 2-3 days

---

### ACU004: Sprint 3 - Core Visualization Components
**Goal:** Build 3D visualizer, frequency explorer, treatment simulator

**Tasks:**
- [ ] 3D Room Visualizer
  - Three.js scene setup
  - Room geometry and positions
  - Panel placement controls
  - Camera controls (orbit, zoom)
  
- [ ] Frequency Explorer
  - Response curve charts
  - Modal analysis highlights
  - Position selector
  - Frequency range filtering
  
- [ ] Treatment Simulator
  - Parameter controls (count, thickness, drape)
  - Live RT60/STI calculations
  - Cost tracking
  - Results visualization

**Deliverables:**
- Three interactive visualization components
- Real-time calculation updates
- Responsive layouts

**Estimated:** 4-6 days

---

### ACU005: Sprint 4 - Interactive Features & Polish
**Goal:** Add comparison mode, mobile UX, accessibility, deployment

**Tasks:**
- [ ] Comparison Mode (before/after side-by-side)
- [ ] Mobile responsive design
- [ ] Touch interactions for 3D
- [ ] Accessibility audit (WCAG AA)
- [ ] Export functionality (PNG, PDF, data)
- [ ] Performance optimization
- [ ] Deployment setup (CF Pages or Vercel)
- [ ] Documentation for deployment

**Deliverables:**
- Fully responsive app
- Accessible interface
- Live production deployment
- Deployment runbook

**Estimated:** 3-4 days

---

## Acceptance Criteria

### Overall Project Success
- [x] All backend data preserved (CSV â†’ JSON, validated)
- [x] Calculation outputs match v1 exactly (within 0.1% tolerance)
- [ ] <100ms interaction response time (measured)
- [ ] Mobile responsive (320px â†’ 4K tested)
- [ ] WCAG 2.1 AA compliant (automated audit pass)
- [ ] 60fps 3D rendering (frame rate measured)
- [ ] Deployed to production (public URL)

### Documentation Success
- [x] ACU001-ACU005 sprint docs complete
- [ ] Each sprint has status updates
- [ ] API documentation for calculation functions
- [ ] Deployment runbook written
- [ ] README updated with v2 usage

---

## Implementation Notes

### For Claude Code Autonomous Operation

**Decision Authority:**
You have full authority to make technical decisions on:
- Framework selection (justify in ACU003)
- Component architecture
- Visual design choices
- Testing strategies
- Build/deployment tools

**Must Consult Chris On:**
- Any changes to preserved data/formulas
- Blocking issues preventing sprint completion
- Major architectural pivots not in sprint plan

**Working Protocol:**
1. Read ACU00X sprint doc completely before starting
2. Work autonomously unless blocked
3. Document decisions in `.claude/scratch/sprint-notes.md`
4. Update sprint status when complete
5. Signal readiness for next sprint

**Context Management:**
- Only load files being actively modified
- Use `.claude/context/original-implementation.md` for reference
- Load skills as needed:
  - `visualization-architect` - always
  - `data-validator` - when touching data
  - `test-analyzer` - when writing tests

### Calculation Validation Strategy

For every ported calculation function:
1. Extract test cases from v1 code (inputs + expected outputs)
2. Implement function in v2
3. Run test suite (must match within 0.1%)
4. Document any deviations with rationale

**Critical Functions to Test:**
- `calculate_rt60(volume, surface_area, absorption)`
- `calculate_sti_degradation(rt60, noise, frequency_response)`
- `identify_room_modes(length, width, height)`
- `calculate_panel_absorption(thickness, frequency)`

### 3D Visualization Requirements

**Room Coordinate System:**
```javascript
// Origin at front-left floor corner
const room = {
  width: 12.3,   // x-axis (feet)
  depth: 10.6,   // y-axis (feet)
  height: 8.2    // z-axis (feet)
};

// Preserve exact positions from v1
const positions = {
  HostA: { x: 1.0, y: 0.33, z: 4.0 },  // 4" from source
  HostB: { x: 6.15, y: 5.3, z: 4.0 },  // Host position
  // ... (copy from original-implementation.md)
};
```

**Panel Placement:**
- Panels on walls only (not ceiling/floor)
- Distributed based on modal analysis (high pressure zones)
- Visual feedback: absorption heatmap on walls
- Real-time RT60 recalculation as panels added

### Data Format (JSON)

Convert CSV â†’ JSON for faster loading:

```json
{
  "measurements": {
    "HostA": [
      { "freq": 20, "spl": 45.2, "phase": -12.5 },
      { "freq": 25, "spl": 46.8, "phase": -15.3 },
      ...
    ],
    "HostB": [ ... ],
    ...
  },
  "metadata": {
    "date": "2025-07-15",
    "reference_position": "HostA",
    "frequency_range": [20, 20000],
    "standards": ["ITU-R BS.1116", "EBU R128"]
  }
}
```

---

## References

[1] Original v1 code: `/Users/chrislyons/Documents/CL/dev/std8/cbc-interactive-dashboard/`  
[2] Live v1 site: https://cbc-acoustics-dashboard.streamlit.app/  
[3] GitHub v1: https://github.com/chrislyons/cbc-acoustics-dashboard  
[4] ITU-R BS.1116-3: https://www.itu.int/rec/R-REC-BS.1116/  
[5] IEC 60268-16: Speech intelligibility measurement  
[6] Three.js docs: https://threejs.org/docs/  
[7] Next.js docs: https://nextjs.org/docs  
[8] Cloudflare Pages: https://pages.cloudflare.com/  

---

**Next Steps for Claude Code:**

1. âœ… ACU001 complete (this document)
2. â†’ Read ACU002 Sprint 1: Project Setup & Data Migration
3. â†’ Execute ACU002 autonomously
4. â†’ Update ACU002 status when complete
5. â†’ Proceed to ACU003

**For Chris:** This project is ready for autonomous Claude Code execution. Point Claude at ACU002 to begin Sprint 1.

---

**Status:** âœ… Complete  
**Last Updated:** $(date +%Y-%m-%d)  
**Next Sprint:** ACU002 Sprint 1: Project Setup & Data Migration
